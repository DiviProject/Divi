\hypertarget{class_c_addr_man}{}\section{C\+Addr\+Man Class Reference}
\label{class_c_addr_man}\index{C\+Addr\+Man@{C\+Addr\+Man}}


{\ttfamily \#include $<$addrman.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$typename Stream $>$ }\\void \mbox{\hyperlink{class_c_addr_man_a08668d8cf435750a80316b4708bbc9eb}{Serialize}} (Stream \&s, int n\+Type, int n\+Version\+Dummy) const
\item 
\mbox{\Hypertarget{class_c_addr_man_a68eaf1797ecb8bff380aa7f9fc452e14}\label{class_c_addr_man_a68eaf1797ecb8bff380aa7f9fc452e14}} 
{\footnotesize template$<$typename Stream $>$ }\\void {\bfseries Unserialize} (Stream \&s, int n\+Type, int n\+Version\+Dummy)
\item 
\mbox{\Hypertarget{class_c_addr_man_a958c50de16b0d7fa068cce22a4cd8cb9}\label{class_c_addr_man_a958c50de16b0d7fa068cce22a4cd8cb9}} 
unsigned int {\bfseries Get\+Serialize\+Size} (int n\+Type, int n\+Version) const
\item 
\mbox{\Hypertarget{class_c_addr_man_a53c27520b7f8c6fa817c2fa869dd4e25}\label{class_c_addr_man_a53c27520b7f8c6fa817c2fa869dd4e25}} 
void {\bfseries Clear} ()
\item 
\mbox{\Hypertarget{class_c_addr_man_a15b8e72f55344b6fbd1bc1bda3cdc5bc}\label{class_c_addr_man_a15b8e72f55344b6fbd1bc1bda3cdc5bc}} 
int \mbox{\hyperlink{class_c_addr_man_a15b8e72f55344b6fbd1bc1bda3cdc5bc}{size}} ()
\begin{DoxyCompactList}\small\item\em Return the number of (unique) addresses in all tables. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a0c2677ae50ce0d680f0105b285d1f5d0}\label{class_c_addr_man_a0c2677ae50ce0d680f0105b285d1f5d0}} 
void \mbox{\hyperlink{class_c_addr_man_a0c2677ae50ce0d680f0105b285d1f5d0}{Check}} ()
\begin{DoxyCompactList}\small\item\em Consistency check. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a03fcc7109b5f014760dc50a81f68c5ec}\label{class_c_addr_man_a03fcc7109b5f014760dc50a81f68c5ec}} 
bool \mbox{\hyperlink{class_c_addr_man_a03fcc7109b5f014760dc50a81f68c5ec}{Add}} (const \mbox{\hyperlink{class_c_address}{C\+Address}} \&addr, const \mbox{\hyperlink{class_c_net_addr}{C\+Net\+Addr}} \&source, int64\+\_\+t n\+Time\+Penalty=0)
\begin{DoxyCompactList}\small\item\em Add a single address. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_aa2ae2abdf710b2d81fa37f072bab028e}\label{class_c_addr_man_aa2ae2abdf710b2d81fa37f072bab028e}} 
bool \mbox{\hyperlink{class_c_addr_man_aa2ae2abdf710b2d81fa37f072bab028e}{Add}} (const std\+::vector$<$ \mbox{\hyperlink{class_c_address}{C\+Address}} $>$ \&v\+Addr, const \mbox{\hyperlink{class_c_net_addr}{C\+Net\+Addr}} \&source, int64\+\_\+t n\+Time\+Penalty=0)
\begin{DoxyCompactList}\small\item\em Add multiple addresses. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a993e80e74701d7bc6bb49880c387b847}\label{class_c_addr_man_a993e80e74701d7bc6bb49880c387b847}} 
void \mbox{\hyperlink{class_c_addr_man_a993e80e74701d7bc6bb49880c387b847}{Good}} (const \mbox{\hyperlink{class_c_service}{C\+Service}} \&addr, int64\+\_\+t n\+Time=Get\+Adjusted\+Time())
\begin{DoxyCompactList}\small\item\em Mark an entry as accessible. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_afcddc2573121065177dc981cea710789}\label{class_c_addr_man_afcddc2573121065177dc981cea710789}} 
void \mbox{\hyperlink{class_c_addr_man_afcddc2573121065177dc981cea710789}{Attempt}} (const \mbox{\hyperlink{class_c_service}{C\+Service}} \&addr, int64\+\_\+t n\+Time=Get\+Adjusted\+Time())
\begin{DoxyCompactList}\small\item\em Mark an entry as connection attempted to. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_c_address}{C\+Address}} \mbox{\hyperlink{class_c_addr_man_ae4b1b65cc15f9a12f90db362fb9c8488}{Select}} ()
\item 
\mbox{\Hypertarget{class_c_addr_man_a69cc6138e696cf88de60925d26023bf2}\label{class_c_addr_man_a69cc6138e696cf88de60925d26023bf2}} 
std\+::vector$<$ \mbox{\hyperlink{class_c_address}{C\+Address}} $>$ \mbox{\hyperlink{class_c_addr_man_a69cc6138e696cf88de60925d26023bf2}{Get\+Addr}} ()
\begin{DoxyCompactList}\small\item\em Return a bunch of addresses, selected at random. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a7aba66d9e9527522fed974567d34c322}\label{class_c_addr_man_a7aba66d9e9527522fed974567d34c322}} 
void \mbox{\hyperlink{class_c_addr_man_a7aba66d9e9527522fed974567d34c322}{Connected}} (const \mbox{\hyperlink{class_c_service}{C\+Service}} \&addr, int64\+\_\+t n\+Time=Get\+Adjusted\+Time())
\begin{DoxyCompactList}\small\item\em Mark an entry as currently-\/connected-\/to. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_c_addr_man_ac961ead1a1afde144fc486b6d7c7369d}\label{class_c_addr_man_ac961ead1a1afde144fc486b6d7c7369d}} 
\mbox{\hyperlink{class_c_addr_info}{C\+Addr\+Info}} $\ast$ \mbox{\hyperlink{class_c_addr_man_ac961ead1a1afde144fc486b6d7c7369d}{Find}} (const \mbox{\hyperlink{class_c_net_addr}{C\+Net\+Addr}} \&addr, int $\ast$pn\+Id=N\+U\+LL)
\begin{DoxyCompactList}\small\item\em Find an entry. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_c_addr_info}{C\+Addr\+Info}} $\ast$ \mbox{\hyperlink{class_c_addr_man_aac93f51c0580e38a950a0f63b053bedb}{Create}} (const \mbox{\hyperlink{class_c_address}{C\+Address}} \&addr, const \mbox{\hyperlink{class_c_net_addr}{C\+Net\+Addr}} \&addr\+Source, int $\ast$pn\+Id=N\+U\+LL)
\item 
\mbox{\Hypertarget{class_c_addr_man_a3074bc8e3dcfb5348054613f575dc38e}\label{class_c_addr_man_a3074bc8e3dcfb5348054613f575dc38e}} 
void \mbox{\hyperlink{class_c_addr_man_a3074bc8e3dcfb5348054613f575dc38e}{Swap\+Random}} (unsigned int n\+Random\+Pos1, unsigned int n\+Random\+Pos2)
\begin{DoxyCompactList}\small\item\em Swap two elements in v\+Random. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a98e8383efb48b7c2932795438f35a10a}\label{class_c_addr_man_a98e8383efb48b7c2932795438f35a10a}} 
void \mbox{\hyperlink{class_c_addr_man_a98e8383efb48b7c2932795438f35a10a}{Make\+Tried}} (\mbox{\hyperlink{class_c_addr_info}{C\+Addr\+Info}} \&info, int n\+Id)
\begin{DoxyCompactList}\small\item\em Move an entry from the \char`\"{}new\char`\"{} table(s) to the \char`\"{}tried\char`\"{} table. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_af488eac123030538770dbc4e3b16eb74}\label{class_c_addr_man_af488eac123030538770dbc4e3b16eb74}} 
void \mbox{\hyperlink{class_c_addr_man_af488eac123030538770dbc4e3b16eb74}{Delete}} (int n\+Id)
\begin{DoxyCompactList}\small\item\em Delete an entry. It must not be in tried, and have refcount 0. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_ab283de3e750f006c85573976bd40da81}\label{class_c_addr_man_ab283de3e750f006c85573976bd40da81}} 
void \mbox{\hyperlink{class_c_addr_man_ab283de3e750f006c85573976bd40da81}{Clear\+New}} (int n\+U\+Bucket, int n\+U\+Bucket\+Pos)
\begin{DoxyCompactList}\small\item\em Clear a position in a \char`\"{}new\char`\"{} table. This is the only place where entries are actually deleted. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a33ec6a4584cf4b17af821e6e35216459}\label{class_c_addr_man_a33ec6a4584cf4b17af821e6e35216459}} 
void \mbox{\hyperlink{class_c_addr_man_a33ec6a4584cf4b17af821e6e35216459}{Good\+\_\+}} (const \mbox{\hyperlink{class_c_service}{C\+Service}} \&addr, int64\+\_\+t n\+Time)
\begin{DoxyCompactList}\small\item\em Mark an entry \char`\"{}good\char`\"{}, possibly moving it from \char`\"{}new\char`\"{} to \char`\"{}tried\char`\"{}. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a9dd6df8b1904548a86054d19d4a90724}\label{class_c_addr_man_a9dd6df8b1904548a86054d19d4a90724}} 
bool \mbox{\hyperlink{class_c_addr_man_a9dd6df8b1904548a86054d19d4a90724}{Add\+\_\+}} (const \mbox{\hyperlink{class_c_address}{C\+Address}} \&addr, const \mbox{\hyperlink{class_c_net_addr}{C\+Net\+Addr}} \&source, int64\+\_\+t n\+Time\+Penalty)
\begin{DoxyCompactList}\small\item\em Add an entry to the \char`\"{}new\char`\"{} table. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_ab1a1bfa8b435ef139570c88de1a5245f}\label{class_c_addr_man_ab1a1bfa8b435ef139570c88de1a5245f}} 
void \mbox{\hyperlink{class_c_addr_man_ab1a1bfa8b435ef139570c88de1a5245f}{Attempt\+\_\+}} (const \mbox{\hyperlink{class_c_service}{C\+Service}} \&addr, int64\+\_\+t n\+Time)
\begin{DoxyCompactList}\small\item\em Mark an entry as attempted to connect. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_c_address}{C\+Address}} \mbox{\hyperlink{class_c_addr_man_af34f24d32505ff3590cbacbc4cc4c09e}{Select\+\_\+}} ()
\item 
\mbox{\Hypertarget{class_c_addr_man_aff86d04dc7c0e0afae3ff5998417db17}\label{class_c_addr_man_aff86d04dc7c0e0afae3ff5998417db17}} 
void \mbox{\hyperlink{class_c_addr_man_aff86d04dc7c0e0afae3ff5998417db17}{Get\+Addr\+\_\+}} (std\+::vector$<$ \mbox{\hyperlink{class_c_address}{C\+Address}} $>$ \&v\+Addr)
\begin{DoxyCompactList}\small\item\em Select several addresses at once. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_c_addr_man_a1ae72643c51293f3f3345e74ce0368ca}\label{class_c_addr_man_a1ae72643c51293f3f3345e74ce0368ca}} 
void \mbox{\hyperlink{class_c_addr_man_a1ae72643c51293f3f3345e74ce0368ca}{Connected\+\_\+}} (const \mbox{\hyperlink{class_c_service}{C\+Service}} \&addr, int64\+\_\+t n\+Time)
\begin{DoxyCompactList}\small\item\em Mark an entry as currently-\/connected-\/to. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Stochastical (IP) address manager 

\subsection{Member Function Documentation}
\mbox{\Hypertarget{class_c_addr_man_aac93f51c0580e38a950a0f63b053bedb}\label{class_c_addr_man_aac93f51c0580e38a950a0f63b053bedb}} 
\index{C\+Addr\+Man@{C\+Addr\+Man}!Create@{Create}}
\index{Create@{Create}!C\+Addr\+Man@{C\+Addr\+Man}}
\subsubsection{\texorpdfstring{Create()}{Create()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_c_addr_info}{C\+Addr\+Info}} $\ast$ C\+Addr\+Man\+::\+Create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_c_address}{C\+Address}} \&}]{addr,  }\item[{const \mbox{\hyperlink{class_c_net_addr}{C\+Net\+Addr}} \&}]{addr\+Source,  }\item[{int $\ast$}]{pn\+Id = {\ttfamily NULL} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

find an entry, creating it if necessary. n\+Time and n\+Services of the found node are updated, if necessary. \mbox{\Hypertarget{class_c_addr_man_ae4b1b65cc15f9a12f90db362fb9c8488}\label{class_c_addr_man_ae4b1b65cc15f9a12f90db362fb9c8488}} 
\index{C\+Addr\+Man@{C\+Addr\+Man}!Select@{Select}}
\index{Select@{Select}!C\+Addr\+Man@{C\+Addr\+Man}}
\subsubsection{\texorpdfstring{Select()}{Select()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_c_address}{C\+Address}} C\+Addr\+Man\+::\+Select (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Choose an address to connect to. n\+Unk\+Bias determines how much \char`\"{}new\char`\"{} entries are favored over \char`\"{}tried\char`\"{} ones (0-\/100). \mbox{\Hypertarget{class_c_addr_man_af34f24d32505ff3590cbacbc4cc4c09e}\label{class_c_addr_man_af34f24d32505ff3590cbacbc4cc4c09e}} 
\index{C\+Addr\+Man@{C\+Addr\+Man}!Select\+\_\+@{Select\+\_\+}}
\index{Select\+\_\+@{Select\+\_\+}!C\+Addr\+Man@{C\+Addr\+Man}}
\subsubsection{\texorpdfstring{Select\+\_\+()}{Select\_()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_c_address}{C\+Address}} C\+Addr\+Man\+::\+Select\+\_\+ (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Select an address to connect to. n\+Unk\+Bias determines how much to favor new addresses over tried ones (min=0, max=100) \mbox{\Hypertarget{class_c_addr_man_a08668d8cf435750a80316b4708bbc9eb}\label{class_c_addr_man_a08668d8cf435750a80316b4708bbc9eb}} 
\index{C\+Addr\+Man@{C\+Addr\+Man}!Serialize@{Serialize}}
\index{Serialize@{Serialize}!C\+Addr\+Man@{C\+Addr\+Man}}
\subsubsection{\texorpdfstring{Serialize()}{Serialize()}}
{\footnotesize\ttfamily template$<$typename Stream $>$ \\
void C\+Addr\+Man\+::\+Serialize (\begin{DoxyParamCaption}\item[{Stream \&}]{s,  }\item[{int}]{n\+Type,  }\item[{int}]{n\+Version\+Dummy }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}

serialized format\+:
\begin{DoxyItemize}
\item version byte (currently 1)
\item 0x20 + n\+Key (serialized as if it were a vector, for backward compatibility)
\item n\+New
\item n\+Tried
\item number of \char`\"{}new\char`\"{} buckets X\+OR 2$\ast$$\ast$30
\item all n\+New addrinfos in vv\+New
\item all n\+Tried addrinfos in vv\+Tried
\item for each bucket\+:
\begin{DoxyItemize}
\item number of elements
\item for each element\+: index
\end{DoxyItemize}
\end{DoxyItemize}

2$\ast$$\ast$30 is xorred with the number of buckets to make addrman deserializer v0 detect it as incompatible. This is necessary because it did not check the version number on deserialization.

Notice that vv\+Tried, map\+Addr and v\+Vector are never encoded explicitly; they are instead reconstructed from the other information.

vv\+New is serialized, but only used if A\+D\+D\+R\+M\+A\+N\+\_\+\+U\+N\+K\+O\+W\+N\+\_\+\+B\+U\+C\+K\+E\+T\+\_\+\+C\+O\+U\+NT didn\textquotesingle{}t change, otherwise it is reconstructed as well.

This format is more complex, but significantly smaller (at most 1.\+5 MiB), and supports changes to the A\+D\+D\+R\+M\+A\+N\+\_\+ parameters without breaking the on-\/disk structure.

We don\textquotesingle{}t use A\+D\+D\+\_\+\+S\+E\+R\+I\+A\+L\+I\+Z\+E\+\_\+\+M\+E\+T\+H\+O\+DS since the serialization and deserialization code has very little in common. 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
P\+I\+V\+X/src/addrman.\+h\item 
P\+I\+V\+X/src/addrman.\+cpp\end{DoxyCompactItemize}
